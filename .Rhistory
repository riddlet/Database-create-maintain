right_join(df)
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_pre) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_post) %>%
distinct() %>%
right_join(df)
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, year, overallgpa_year) %>%
distinct() %>%
right_join(df)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_pre) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_post) %>%
distinct() %>%
right_join(df)
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, year, overallgpa_year) %>%
distinct() %>%
right_join(df)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
#exclude other races from geoff's data
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
names(comp)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat <- read.csv('../Data/data final science 2009.csv')
geoffdat$wbrace0white1black
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
head(geoffdat.sub)
geoffdat.sub$year <- as.numeric(substr(geoff.melt$year, 15,15)) + 6
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df)
head(comp)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoffdat.sub$year <- as.numeric(substr(geoff.melt$year, 15,15)) + 6
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$overall
names(geoffdat.sub)
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
names(comp)
comp$diff
comp$overallgpayear1and2
comp$overallgpa_post
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
geoffdat <- read.csv('../Data/data final science 2009.csv')
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_pre) %>%
distinct() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_post) %>%
distinct() %>%
right_join(df)
## overall gpa for each year
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, year, overallgpa_year) %>%
distinct() %>%
right_join(df)
names(df)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
#exclude other races from geoff's data
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoffdat.sub$year <- as.numeric(substr(geoff.melt$year, 15,15)) + 6
names(geoffdat.sub)
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
comp$overallgpa_post
df$overallgpa_post
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp <- left_join(df, geoffdat.sub[,c(2,3,4,5,7,17,18)])
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
comp$overallgpa_post
comp$overallgpayear1and2
table(df$year)
table(geoffdat.sub$year)
head(geoffdat.sub)
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
#exclude other races from geoff's data
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
head(geoffdat.sub)
geoffdat.sub$year <- as.numeric(substr(geoffdat.sub$year, 15,15)) + 6
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp, aes(x=diff.yr)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp, aes(x=diff.yr)) +
facet_wrap(year~cohort) +
geom_histogram()
df$year <- 7
geoffdat <- read.csv('../Data/data final science 2009.csv')
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_pre) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_post) %>%
distinct() %>%
right_join(df)
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df$year[which(as.numeric(df$quarter)<0)] <- 6
df %<>% group_by(ID, year) %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, year, overallgpa_year) %>%
distinct() %>%
right_join(df)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoffdat.sub$year <- as.numeric(substr(geoffdat.sub$year, 15,15)) + 6
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp, aes(x=diff.yr)) +
facet_wrap(year~cohort) +
geom_histogram()
df.grade <- rbind(#read.csv('../Data/cohort1_long.csv', sep=','),
#read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','))#,
#read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
head(df)
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
head(df)
df[which(df$ID == 3001)]
df[which(df$ID == 3001),]
df[which(df$ID == 3001 & df$quarter == 1),]
2+3+3.3
8.3/3
df[which(df$ID == 3001 & df$quarter == 2),]
df[which(df$ID == 3001 & df$quarter == 3),]
df[which(df$ID == 3001 & df$quarter == 4),]
df[which(df$ID == 3001 & df$quarter == 5),]
df[which(df$ID == 3001 & df$quarter == 6),]
df[which(df$ID == 3001 & df$quarter == 7),]
c3 <- read.spss('../Data/Cohort 3 Student Records 04-05, 05-06, 06-07.sav',
to.data.frame = T)
df.c3 <- read.csv('../Data/cohort3.csv')
names(df.c3)
grep('(sci(enc)?q[1-4]$)|
(sci(enc)?q[1-4]_7$)|
(sci(enc)?q[1-4]_8$)',
names(df.c3))
df.c3$science1
df.c3$science2
df.c3$science3
df.c3$science4
df.c3$scienc04
df.c3$sciq4
grep('(sci(enc)?q[1-4]$)|
(sci(enc?)q[1-4]_7$)|
(sci(enc)?q[1-4]_8$)',
names(df.c3))
grep('(sci(enc)?q[1-4]$)|
(sciq[1-4]_7$)|
(sci(enc)?q[1-4]_8$)',
names(df.c3))
grep('(sci(enc)?q[1-4]$)|
(sciq[1-4]_7$)|
(sci(enc)?q[1-4]_8$)',
names(df.c3))
grep('(sci(enc)?q[1-4]$)|
(sciq1_7$)|
(sci(enc)?q[1-4]_8$)',
names(df.c3))
grep('(sci(enc)?q[1-4]$)|
(sciq1_7)|
(sci(enc)?q[1-4]_8$)',
names(df.c3))
grep('sciq1_7', names(df.c3))
grep('(sci(enc)?q[1-4]$)|sci(enc)?q[1-4]_7$)|(sci(enc)?q[1-4]_8$)',
names(df.c3)))
grep('(sci(enc)?q[1-4]$)|sci(enc)?q[1-4]_7$)|(sci(enc)?q[1-4]_8$)', names(df.c3))
grep('(sci(enc)?q[1-4]$)|sciq[1-4]_7$)|(sci(enc)?q[1-4]_8$)', names(df.c3))
grep('(sci(enc)?q[1-4]$)|sciq1_7$)|(sci(enc)?q[1-4]_8$)', names(df.c3))
grep('(sci(enc)?q[1-4]$)|(sciq1_7$)|(sci(enc)?q[1-4]_8$)', names(df.c3))
grep('(sci(enc)?q[1-4]$)|(sciq[1-4]_7$)|(sci(enc)?q[1-4]_8$)', names(df.c3))
df.c3 <- read.csv('../Data/cohort3.csv')
gradecols <- c(grep('artq[1-4]$', names(df.c3)),
grep('peq[1-4]$', names(df.c3)),
grep('readq[1-4]$', names(df.c3)),
grep('spe(1-2?)q[1-4]$)', names(df.c3)),
grep('(ssq[1-4]$)|(ssq[1-4]_7$)|(ssq[1-4]_8$)', names(df.c3)),
grep('(eng(l?)q[1-4]$)|(eng(l?)q[1-4](a?)_7$)|(engq[1-4]_8$)',
names(df.c3), perl=T),
grep('(mat(h?)q[1-4]$)|(mat(h?)q[1-4]_7$)|(mathq[1-4]_8$)',
names(df.c3)),
grep('(pre(al(g?))?q[1-4]_7$)|(pre(al(g)?)?q[1-4]_8$)',
names(df.c3)),
grep('^algq[1-4]_8$', names(df.c3)),
grep('(sci(enc)?q[1-4]$)|(sciq[1-4]_7$)|(sci(enc)?q[1-4]_8$)',
names(df.c3)))
df.c3.l <- melt(df.c3, id.vars='id', measure.vars=names(df.c3)[gradecols])
df.c3.l$yr <- 6
df.c3.l$yr[which(grepl('_7', df.c3.l$variable))] <- 7
df.c3.l$yr[which(grepl('_8', df.c3.l$variable))] <- 8
df.c3.l$quarter <- str_extract(df.c3.l$variable, '\\d')
df.c3.l$quarter <- as.numeric(df.c3.l$quarter)
df.c3.l$quarter[which(df.c3.l$yr == 6)] <-
df.c3.l$quarter[which(df.c3.l$yr == 6)]-5
df.c3.l$quarter[which(df.c3.l$yr == 8)] <-
df.c3.l$quarter[which(df.c3.l$yr == 8)]+4
df.c3.l$variable <- substr(df.c3.l$variable, 1, 2)
df.c3.l$variable <- factor(df.c3.l$variable,
labels = c('Math', 'Special', 'English', 'Math',
'Special', 'Math', 'Special', 'Science',
'Social Studies'))
df.c3.l$variable <- droplevels((df.c3.l$variable))
df.c3.l$value <- factor(df.c3.l$value)
df.c3.l$numericgrade <- factor(df.c3.l$value,
labels=c('', '4.0', '3.7', '4.3', '3.0', '2.7',
'3.3', '2.0', '1.7', '2.3', '1.0',
'.7', '1.3', '0', '', '', '', ''))
df.c3.l$numericgrade <- as.numeric(as.character(df.c3.l$numericgrade))
df.c3.l$Study <- 'Connecticut'
names(df.c3.l)[1] <- 'ID'
write.csv(df.c3.l[,c(1,2,3,5,6,7)], '../Data/cohort3_long.csv', row.names = F)
library(dplyr) #there are some package conflicts that can cause problems here
library(ggplot2)
library(foreign)
library(lme4)
library(tidyr)
geoffdat <- read.csv('../Data/data final science 2009.csv')
df.grade <- rbind(#read.csv('../Data/cohort1_long.csv', sep=','),
#read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','))#,
#read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_pre) %>%
distinct() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_post) %>%
distinct() %>%
right_join(df)
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df$year[which(as.numeric(df$quarter)<0)] <- 6
df %<>% group_by(ID, year) %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, year, overallgpa_year) %>%
distinct() %>%
right_join(df)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoffdat.sub$year <- as.numeric(substr(geoffdat.sub$year, 15,15)) + 6
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp, aes(x=diff.yr)) +
facet_wrap(year~cohort) +
geom_histogram()
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','))#,
read.csv('../Data/cohort4_long.csv', sep=','))
df.c4 <- read.csv('../Data/cohort4.csv')
grep('artq[1-4]$', names(df.c4))
grep('peq[1-4]$', names(df.c4))
grep('readq[1-4]$', names(df.c4))
grep('spe[1-4?]q[1-4]$', names(df.c4))
grep('(ssq[1-4]$)|(ssq[1-4]_7$)|(ssq[1-4]_8$)', names(df.c4))
grep('(eng(l?)q[1-4]$)|(eng(l?)q[1-4](a?)_7$)|(engq[1-4]_8$)',
names(df.c4), perl=T),
grep('(eng(l?)q[1-4]$)|(eng(l?)q[1-4](a?)_7$)|(engq[1-4]_8$)',
names(df.c4), perl=T)
grep('(mat(h?)q[1-4]$)|(mat(h?)q[1-4]_7$)|(mathq[1-4]_8$)',
names(df.c4))
grep('(pre(al(g?))?q[1-4]_7$)|(pre(al(g)?)?q[1-4]_8$)', names(df.c4))
grep('^algq[1-4]_8$', names(df.c4))
grep('sci(enc)?q[1-4]$|sciq[1-4]_7$|sci(enc)?q[1-4]_8$',
names(df.c4))
geoffdat <- read.csv('../Data/data final science 2009.csv')
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=',')),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
select(ID, quarter, Ethnicity, Gender, overallgpa_qtr) %>%
distinct() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_pre) %>%
distinct() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, overallgpa_post) %>%
distinct() %>%
right_join(df)
## overall gpa for each year
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df$year[which(as.numeric(df$quarter)<0)] <- 6
df %<>% group_by(ID, year) %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
select(ID, Ethnicity, Gender, year, overallgpa_year) %>%
distinct() %>%
right_join(df)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
#exclude other races from geoff's data
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
geoffdat.sub <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoffdat.sub$year <- as.numeric(substr(geoffdat.sub$year, 15,15)) + 6
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,17,18)], df)
comp$diff <- comp$overallgpayear1and2 - comp$overallgpa_post
comp$diff.yr <- comp$yeargrades - comp$overallgpa_year
comp$cohort <- substr(comp$ID, 1,1)
ggplot(comp, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp, aes(x=diff.yr)) +
facet_wrap(year~cohort) +
geom_histogram()
