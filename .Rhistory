facet_grid(comp.complete$cohort) +
geom_histogram()
ggplot(comp.complete, aes(x=diff)) +
facet_wrap(cohort) +
geom_histogram()
names(comp.complete)
ggplot(comp.complete, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
ggplot(comp.complete, aes(x=diff_yr)) +
facet_grid(year~cohort) +
geom_histogram()
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df.mod[,c(1,2,3,4,5,6,7,8)])
comp$cohort <- substr(comp$ID, 1,1)
#only use participants for whom we have complete records
comp$diff <- comp$overallgpayear1and2-comp$overallgpa_post
comp.complete <- comp[which(!is.na(comp$overallgpa_post)),]
comp.complete <- comp.complete[which(!is.na(comp.complete$overallgpayear1and2)),]
ggplot(comp.complete, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
comp$diff_yr8[which(comp$year=='8')] <-
comp$overallgpayear2[which(comp$year=='8')] -
comp$overallgpa_year[which(comp$year=='8')]
comp$diff_yr7[which(comp$year=='7')] <-
comp$overallgpayear1[which(comp$year=='7')] -
comp$overallgpa_year[which(comp$year=='7')]
comp$overallgpayear1[which(comp$year=='7')] -
comp$overallgpa_year[which(comp$year=='7')]
length(  comp$overallgpayear1[which(comp$year=='7')] -
comp$overallgpa_year[which(comp$year=='7')])
length(comp[which(comp$year=='7'),1])
?cast
library(tidyr)
gather(geoffdat.sub, key = ID, value = 'yeargrades', c(overallgpayear1, overallgpayear2))
geoff.melt <- gather(geoffdat.sub, key = ID, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
head(geoff.melt)
geoff.melt <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
head(geoff.melt)
substr(geoff.melt$year, 14,15)
substr(geoff.melt$year, 15,15)
geoff.melt$year <- substr(geoff.melt$year, 15,15)
geoff.melt$year <- as.numeric(substr(geoff.melt$year, 15,15))
head(geoff.melt)
geoff.melt$year <- substr(geoff.melt$year, 15,15)
geoff.melt$year
geoff.melt <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoff.melt$year <- substr(geoff.melt$year, 15,15)
head(geoff.melt)
str(geoff.melt$year)
geoff.melt <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoff.melt$year <- as.numeric(substr(geoff.melt$year, 15,15))
head(geoff.melt)
geoff.melt$year <- as.numeric(substr(geoff.melt$year, 15,15)) + 6
geoff.melt <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoff.melt$year <- as.numeric(substr(geoff.melt$year, 15,15)) + 6
head(geoff.melt)
head(geoffdat.sub)
geoff.melt[which(geoff.melt$ID==3082)]
geoff.melt[which(geoff.melt$ID==3082),]
names(df.mod)
comp.year <- left_join(geoff.melt[,c(2:5,17,18)], df.mod)
head(comp.year)
comp.year$yeardiff <- comp.year$yeargrades-comp.year$overallgpa_year
comp.year$cohort <- substr(comp.year$ID, 1,1)
ggplot(comp.year, aes(x=yeardiff)) +
facet_grid(year~cohort) +
geom_histogram()
comp.year[which(comp.year$cohort==1),]
comp.year[which(comp.year$ID==1001),]
comp.year[which(comp.year$ID==1002),]
comp.year[which(comp.year$ID==1003),]
comp.year[which(comp.year$ID==1004),]
comp.year[which(comp.year$ID==1005),]
comp.year[which(comp.year$ID==1006),]
df.c1.7<-read.csv('../Data/cohort1_grade7.csv')
gradecols <- c(grep('socstud', names(df.c1.7)),
grep('engl[1-4](?!b)', perl=T, names(df.c1.7)),
grep('math[1-4]$', names(df.c1.7)),
grep('prealg', names(df.c1.7)),
grep('science', names(df.c1.7)))
#to long
df.7.l <- melt(df.c1.7, id.vars='id', measure.vars=names(df.c1.7)[gradecols])
#split into class and quarter convert to standard data format
df.7.l$quarter <- substr(sub('[a-z]*([1-4])', '\\1', df.7.l$variable), 1,1)
df.7.l$quarter <- as.numeric(df.7.l$quarter)
df.7.l$variable <- substr(df.7.l$variable, 1, 4)
df.7.l$variable <- factor(df.7.l$variable,
labels = c('English', 'Math', 'Math',
'Science','Social Studies'))
df.7.l$variable <- droplevels((df.7.l$variable))
df.7.l$value <- factor(df.7.l$value)
df.7.l$numericgrade <- factor(df.7.l$value,
labels=c('', '', '4.0', '3.7', '4.3', '3.0',
'2.7', '3.3', '2.0', '1.7', '2.3',
'1.0', '.7', '1.3', '0', '', ''))
df.7.l$numericgrade <- as.numeric(as.character(df.7.l$numericgrade))
df.7.l $>$ group_by(ID) %>% mutate(ave=mean(value, na.rm=T))
df.7.l %>% group_by(ID) %>% mutate(ave=mean(value, na.rm=T))
df.7.l %>% group_by(id) %>% mutate(ave=mean(value, na.rm=T))
df.7.l %>% group_by(id) %>% mutate(ave=mean(value, na.omit=T))
df.7.l %>% group_by(id) %>% mutate(ave=mean(numericgrade, na.rm=T))
comp.year[which(comp.year$ID==1001),]
comp.year[which(comp.year$ID==1002),]
comp.year[which(comp.year$ID==1003),]
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
distinct() %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
distinct() %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
distinct() %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
distinct() %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
ungroup()
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
distinct() %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall gpa for each year
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
distinct() %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
df.ess <- read.csv('../Data/3 CSV Files/essays11.13.15.csv', sep='|', quote="")
df.ess <- left_join(df.ess, df.dem)
df.ess <- df.ess[which(df.ess$Study=='Connecticut'),]
df.ess <- df.ess[which(df.ess$Condition!=''),]
df.ess$Condition <- droplevels(df.ess$Condition)
#combining odd levels of treatment
levels(df.ess$Condition) <- c(rep('Treatment', 2),rep('Control', 8),
rep('Treatment', 6))
df.ess <- df.ess[which(df.ess$Condition=='Control' |
df.ess$Condition=='Treatment'),]
# df.ess$Intervention_Date <- as.Date(droplevels(df.ess$Intervention_Date),
#                                     format='%m/%d/%Y')
#get what condition they start in
temp <- df.ess %>%
group_by(ID) %>%
filter(Intervention_number == min(Intervention_number))
temp <- temp[,c(1,5)]
names(temp)[2] <- 'first_cond'
df.ess <- left_join(df.ess, temp)
df.ess <- df.ess[which(df.ess$Intervention_number==1),]
df <- left_join(df, df.ess[,c(1:3, 5:7, 10:12)], by=c('ID', 'Study'))
df.mod <- df %>%
select(ID, Ethnicity.x, Gender.x, overallgpa_post, first_cond, overallgpa_pre,
overallgpa_year, year) %>%
filter(Ethnicity.x=='African American' |
Ethnicity.x == 'White') %>%
distinct()
df.mod$Ethnicity.x <- droplevels(relevel(df.mod$Ethnicity.x, 'White'))
df.mod$first_cond <- relevel(df.mod$first_cond, 'Control')
m<-lm(overallgpa_post~Ethnicity.x*first_cond, data=df.mod)
summary(m)
geoffdat <- read.csv('../Data/data final science 2009.csv')
m.g <- lm(overallgpayear1and2~condition0control1affirmed*wbrace0white1black,
data=geoffdat)
summary(m.g)
names(df.mod)
df.mod$ID
str(df.mod$ID)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
#exclude other races from geoff's data
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df.mod[,c(1,2,3,4,5,6,7,8)])
comp$cohort <- substr(comp$ID, 1,1)
head(comp)
comp$diff <- comp$overallgpayear1and2-comp$overallgpa_post
comp.complete <- comp[which(!is.na(comp$overallgpa_post)),]
comp.complete <- comp.complete[which(!is.na(comp.complete$overallgpayear1and2)),]
head(comp.complete)
str(comp.complete)
m2<-lm(overallgpa_post~Ethnicity.x*first_cond, data=comp.complete)
summary(m2)
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
distinct() %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall gpa for each year
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
distinct() %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#getting treatment info
df.ess <- read.csv('../Data/3 CSV Files/essays11.13.15.csv', sep='|', quote="")
df.ess <- left_join(df.ess, df.dem)
df.ess <- df.ess[which(df.ess$Study=='Connecticut'),]
df.ess <- df.ess[which(df.ess$Condition!=''),]
df.ess$Condition <- droplevels(df.ess$Condition)
#combining odd levels of treatment
levels(df.ess$Condition) <- c(rep('Treatment', 2),rep('Control', 8),
rep('Treatment', 6))
df.ess <- df.ess[which(df.ess$Condition=='Control' |
df.ess$Condition=='Treatment'),]
temp <- df.ess %>%
group_by(ID) %>%
filter(Intervention_number == min(Intervention_number))
temp <- temp[,c(1,5)]
names(temp)[2] <- 'first_cond'
df.ess <- left_join(df.ess, temp)
df.ess <- df.ess[which(df.ess$Intervention_number==1),]
df <- left_join(df, df.ess[,c(1:3, 5:7, 10:12)], by=c('ID', 'Study'))
df.mod <- df %>%
select(ID, Ethnicity.x, Gender.x, overallgpa_post, first_cond, overallgpa_pre,
overallgpa_year, year) %>%
filter(Ethnicity.x=='African American' |
Ethnicity.x == 'White') %>%
distinct()
df.mod$Ethnicity.x <- droplevels(relevel(df.mod$Ethnicity.x, 'White'))
df.mod$first_cond <- relevel(df.mod$first_cond, 'Control')
m<-lm(overallgpa_post~Ethnicity.x*first_cond, data=df.mod[])
geoffdat <- read.csv('../Data/data final science 2009.csv')
m.g <- lm(overallgpayear1and2~condition0control1affirmed*wbrace0white1black,
data=geoffdat)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df.mod[,c(1,2,3,4,5,6,7,8)])
comp$cohort <- substr(comp$ID, 1,1)
comp$diff <- comp$overallgpayear1and2-comp$overallgpa_post
comp.complete <- comp[which(!is.na(comp$overallgpa_post)),]
comp.complete <- comp.complete[which(!is.na(comp.complete$overallgpayear1and2)),]
ggplot(comp.complete, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
df.grade <- rbind(read.csv('../Data/cohort1_long.csv', sep=','),
read.csv('../Data/cohort2_long.csv', sep=','),
read.csv('../Data/cohort3_long.csv', sep=','),
read.csv('../Data/cohort4_long.csv', sep=','))
df.grade$ID <- as.character(df.grade$ID)
df.dem <- read.csv('../Data/3 CSV Files/demog12.4.15.csv', sep=',')
df.dem <- df.dem[,1:5]
df <- left_join(df.grade, df.dem, by=c('ID', 'Study'))
#first, compute overall gpa at each quarter after the intervention
df %<>% group_by(ID, quarter) %>%
filter(quarter > 0) %>%
distinct() %>%
mutate(overallgpa_qtr = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#get overall gpa in 6th grade
df %<>% group_by(ID) %>%
filter(quarter < 0) %>%
distinct() %>%
mutate(overallgpa_pre = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall post gpa for each student
df %<>% group_by(ID) %>%
filter(quarter > 0) %>%
mutate(overallgpa_post = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
## overall gpa for each year
df$year <- 7
df$year[which(as.numeric(df$quarter)>4)] <- 8
df %<>% group_by(ID, year) %>%
distinct() %>%
mutate(overallgpa_year = mean(numericgrade, na.rm=T)) %>%
ungroup() %>%
right_join(df)
#getting treatment info
df.ess <- read.csv('../Data/3 CSV Files/essays11.13.15.csv', sep='|', quote="")
df.ess <- left_join(df.ess, df.dem)
df.ess <- df.ess[which(df.ess$Study=='Connecticut'),]
df.ess <- df.ess[which(df.ess$Condition!=''),]
df.ess$Condition <- droplevels(df.ess$Condition)
#combining odd levels of treatment
levels(df.ess$Condition) <- c(rep('Treatment', 2),rep('Control', 8),
rep('Treatment', 6))
df.ess <- df.ess[which(df.ess$Condition=='Control' |
df.ess$Condition=='Treatment'),]
# df.ess$Intervention_Date <- as.Date(droplevels(df.ess$Intervention_Date),
#                                     format='%m/%d/%Y')
#get what condition they start in
temp <- df.ess %>%
group_by(ID) %>%
filter(Intervention_number == min(Intervention_number))
temp <- temp[,c(1,5)]
names(temp)[2] <- 'first_cond'
df.ess <- left_join(df.ess, temp)
#join to grade data
df.ess <- df.ess[which(df.ess$Intervention_number==1),]
df <- left_join(df, df.ess[,c(1:3, 5:7, 10:12)], by=c('ID', 'Study'))
#### compare models
df.mod <- df %>%
select(ID, Ethnicity.x, Gender.x, overallgpa_post, first_cond, overallgpa_pre,
overallgpa_year, year) %>%
filter(Ethnicity.x=='African American' |
Ethnicity.x == 'White') %>%
distinct()
df.mod$Ethnicity.x <- droplevels(relevel(df.mod$Ethnicity.x, 'White'))
df.mod$first_cond <- relevel(df.mod$first_cond, 'Control')
m<-lm(overallgpa_post~Ethnicity.x*first_cond, data=df.mod[])
geoffdat <- read.csv('../Data/data final science 2009.csv')
m.g <- lm(overallgpayear1and2~condition0control1affirmed*wbrace0white1black,
data=geoffdat)
names(geoffdat)[2] <- 'ID'
geoffdat$ID <- as.character(geoffdat$ID)
#exclude other races from geoff's data
geoffdat.sub <- geoffdat[which(!is.na(geoffdat$wbrace0white1black)),]
comp <- left_join(geoffdat.sub[,c(2,3,4,5,7,12,13)], df.mod[,c(1,2,3,4,5,6,7,8)])
comp$cohort <- substr(comp$ID, 1,1)
#only use participants for whom we have complete records
comp$diff <- comp$overallgpayear1and2-comp$overallgpa_post
comp.complete <- comp[which(!is.na(comp$overallgpa_post)),]
comp.complete <- comp.complete[which(!is.na(comp.complete$overallgpayear1and2)),]
ggplot(comp.complete, aes(x=diff)) +
facet_wrap(~cohort) +
geom_histogram()
geoff.melt <- gather(geoffdat.sub, key = year, value = 'yeargrades',
c(overallgpayear1, overallgpayear2))
geoff.melt$year <- as.numeric(substr(geoff.melt$year, 15,15)) + 6
comp.year <- left_join(geoff.melt[,c(2:5,17,18)], df.mod)
comp.year$yeardiff <- comp.year$yeargrades-comp.year$overallgpa_year
comp.year$cohort <- substr(comp.year$ID, 1,1)
ggplot(comp.year, aes(x=yeardiff)) +
facet_grid(year~cohort) +
geom_histogram()
